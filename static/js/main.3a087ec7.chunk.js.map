{"version":3,"sources":["images/wQ.svg","images/wR.svg","images/wB.svg","images/wN.svg","config.js","components/SignIn.jsx","App.js","theme.js","index.js"],"names":["module","exports","CONTRACT_NAME","process","env","networkId","nodeUrl","contractName","walletUrl","helperUrl","keyPath","HOME","masterAccount","Error","SignIn","Typography","variant","gutterBottom","useStyles","makeStyles","theme","modal","display","alignItems","justifyContent","cursor","textAlign","paper","backgroundColor","palette","background","boxShadow","shadows","padding","spacing","App","currentUser","nearConfig","wallet","useState","Chess","chess","pendingMove","setPendingMove","modalOpen","setModalOpen","fen","setFen","lastMove","setLastMove","classes","useEffect","randomMove","moves","verbose","move","Math","floor","random","length","san","from","to","promotion","e","setTimeout","component","Button","color","onClick","signOut","window","location","replace","origin","pathname","requestSignIn","turnColor","turn","onMove","i","len","flags","indexOf","style","margin","Modal","open","className","aria-labelledby","aria-describedby","role","src","queen","alt","width","rook","bishop","knight","createMuiTheme","type","primary","main","secondary","error","deepOrange","A400","a","getConfig","nearAPI","deps","keyStore","BrowserLocalStorageKeyStore","near","walletConnection","getAccountId","account","state","amount","accountId","balance","viewMethods","changeMethods","sender","contract","nearInitPromise","initContract","then","ReactDOM","render","ThemeProvider","CssBaseline","document","getElementById"],"mappings":"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","file":"static/js/main.3a087ec7.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/wQ.4e4432a6.svg\";","module.exports = __webpack_public_path__ + \"static/media/wR.57350123.svg\";","module.exports = __webpack_public_path__ + \"static/media/wB.e0eb761a.svg\";","module.exports = __webpack_public_path__ + \"static/media/wN.f9c6e522.svg\";","const CONTRACT_NAME = process.env.CONTRACT_NAME || \"guest-book.testnet\";\n\nfunction getConfig(env) {\n  switch (env) {\n    case \"mainnet\":\n      return {\n        networkId: \"mainnet\",\n        nodeUrl: \"https://rpc.mainnet.near.org\",\n        contractName: CONTRACT_NAME,\n        walletUrl: \"https://wallet.near.org\",\n        helperUrl: \"https://helper.mainnet.near.org\",\n      };\n    // This is an example app so production is set to testnet.\n    // You can move production to mainnet if that is applicable.\n    case \"production\":\n    case \"development\":\n    case \"testnet\":\n      return {\n        networkId: \"default\",\n        nodeUrl: \"https://rpc.testnet.near.org\",\n        contractName: CONTRACT_NAME,\n        walletUrl: \"https://wallet.testnet.near.org\",\n        helperUrl: \"https://helper.testnet.near.org\",\n      };\n    case \"betanet\":\n      return {\n        networkId: \"betanet\",\n        nodeUrl: \"https://rpc.betanet.near.org\",\n        contractName: CONTRACT_NAME,\n        walletUrl: \"https://wallet.betanet.near.org\",\n        helperUrl: \"https://helper.betanet.near.org\",\n      };\n    case \"local\":\n      return {\n        networkId: \"local\",\n        nodeUrl: \"http://localhost:3030\",\n        keyPath: `${process.env.HOME}/.near/validator_key.json`,\n        walletUrl: \"http://localhost:4000/wallet\",\n        contractName: CONTRACT_NAME,\n      };\n    case \"test\":\n    case \"ci\":\n      return {\n        networkId: \"shared-test\",\n        nodeUrl: \"https://rpc.ci-testnet.near.org\",\n        contractName: CONTRACT_NAME,\n        masterAccount: \"test.near\",\n      };\n    case \"ci-betanet\":\n      return {\n        networkId: \"shared-test-staging\",\n        nodeUrl: \"https://rpc.ci-betanet.near.org\",\n        contractName: CONTRACT_NAME,\n        masterAccount: \"test.near\",\n      };\n    default:\n      throw Error(\n        `Unconfigured environment '${env}'. Can be configured in src/config.js.`\n      );\n  }\n}\n\nmodule.exports = getConfig;\n","import React from 'react';\nimport { Typography } from '@material-ui/core';\n\nexport default function SignIn() {\n  return (\n    <Typography variant=\"body1\" gutterBottom>\n      TODO: Some content when the user is not signed in\n    </Typography>\n  );\n}\n","import \"regenerator-runtime/runtime\";\nimport React, { useState, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Chess from \"chess.js\";\nimport { Button, Typography, Modal } from \"@material-ui/core\";\nimport SignIn from \"./components/SignIn\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Chessground from \"react-chessground\";\nimport queen from \"./images/wQ.svg\";\nimport rook from \"./images/wR.svg\";\nimport bishop from \"./images/wB.svg\";\nimport knight from \"./images/wN.svg\";\n\n// const SUGGESTED_DONATION = '0';\n// const BOATLOAD_OF_GAS = Big(3).times(10 ** 13).toFixed();\n\nconst useStyles = makeStyles((theme) => ({\n  modal: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    cursor: \"pointer\",\n    textAlign: \"center\",\n  },\n  paper: {\n    backgroundColor: theme.palette.background.paper,\n    boxShadow: theme.shadows[5],\n    padding: theme.spacing(2, 4, 3),\n  },\n}));\n\n// TODO include contract\nconst App = ({ currentUser, nearConfig, wallet }) => {\n  const [chess] = useState(new Chess());\n  const [pendingMove, setPendingMove] = useState();\n  const [modalOpen, setModalOpen] = useState(false);\n  const [fen, setFen] = useState(\"\");\n  const [lastMove, setLastMove] = useState();\n\n  const classes = useStyles();\n\n  useEffect(() => {\n    // // TODO: don't just fetch once; subscribe!\n    // contract.getMessages().then(setMessages);\n  }, []);\n\n  // const onSubmit = (e) => {\n  //   e.preventDefault();\n\n  //   const { fieldset, message, donation } = e.target.elements;\n\n  //   fieldset.disabled = true;\n\n  //   // TODO: optimistically update page with new message,\n  //   // update blockchain data in background\n  //   // add uuid to each message, so we know which one is already known\n  //   contract.addMessage(\n  //     { text: message.value },\n  //     BOATLOAD_OF_GAS,\n  //     Big(donation.value || '0').times(10 ** 24).toFixed()\n  //   ).then(() => {\n  //     contract.getMessages().then(messages => {\n  //       setMessages(messages);\n  //       message.value = '';\n  //       donation.value = SUGGESTED_DONATION;\n  //       fieldset.disabled = false;\n  //       message.focus();\n  //     });\n  //   });\n  // };\n\n  const signIn = () => {\n    wallet.requestSignIn(nearConfig.contractName, \"NEAR Guest Book\");\n  };\n\n  const signOut = () => {\n    wallet.signOut();\n    window.location.replace(window.location.origin + window.location.pathname);\n  };\n\n  const onMove = (from, to) => {\n    const moves = chess.moves({ verbose: true });\n    for (let i = 0, len = moves.length; i < len; i++) { /* eslint-disable-line */\n      if (moves[i].flags.indexOf(\"p\") !== -1 && moves[i].from === from) {\n        setPendingMove([from, to]);\n        setModalOpen(true);\n        return;\n      }\n    }\n    if (chess.move({ from, to, promotion: \"x\" })) {\n      setFen(chess.fen());\n      setLastMove([from, to]);\n      setTimeout(randomMove, 500);\n    }\n  };\n\n  const randomMove = () => {\n    const moves = chess.moves({ verbose: true });\n    const move = moves[Math.floor(Math.random() * moves.length)];\n    if (moves.length > 0) {\n      chess.move(move.san);\n      setFen(chess.fen());\n      setLastMove([move.from, move.to]);\n    }\n  };\n\n  const promotion = (e) => {\n    const from = pendingMove[0];\n    const to = pendingMove[1];\n    chess.move({ from, to, promotion: e });\n    setFen(chess.fen());\n    setLastMove([from, to]);\n    setModalOpen(false);\n    setTimeout(randomMove, 500);\n  };\n\n  const turnColor = () => {\n    return chess.turn() === \"w\" ? \"white\" : \"black\";\n  };\n\n  return (\n    <>\n      <Typography variant=\"h2\" component=\"h2\" gutterBottom>\n        BlockChess\n      </Typography>\n      {currentUser ? (\n        <Button variant=\"contained\" color=\"secondary\" onClick={signOut}>\n          Log out\n        </Button>\n      ) : (\n        <Button variant=\"contained\" color=\"secondary\" onClick={signIn}>\n          Log in\n        </Button>\n      )}\n      {currentUser ? (\n        <>\n          <Chessground\n            turnColor={turnColor()}\n            lastMove={lastMove}\n            fen={fen}\n            onMove={onMove}\n            style={{ margin: \"auto\" }}\n          />\n          <Modal\n            open={modalOpen}\n            className={classes.modal}\n            aria-labelledby=\"simple-modal-title\"\n            aria-describedby=\"simple-modal-description\"\n          >\n            <div className={classes.paper}>\n              <span role=\"presentation\" onClick={() => promotion(\"q\")}>\n                <img src={queen} alt=\"\" style={{ width: 50 }} />\n              </span>\n              <span role=\"presentation\" onClick={() => promotion(\"r\")}>\n                <img src={rook} alt=\"\" style={{ width: 50 }} />\n              </span>\n              <span role=\"presentation\" onClick={() => promotion(\"b\")}>\n                <img src={bishop} alt=\"\" style={{ width: 50 }} />\n              </span>\n              <span role=\"presentation\" onClick={() => promotion(\"n\")}>\n                <img src={knight} alt=\"\" style={{ width: 50 }} />\n              </span>\n            </div>\n          </Modal>\n        </>\n      ) : (\n        <SignIn />\n      )}\n      {/* {!!currentUser && !!messages.length && <Messages messages={messages} />} */}\n    </>\n  );\n};\n\nApp.propTypes = {\n  contract: PropTypes.shape({\n    getBoardState: PropTypes.func.isRequired,\n    createGame: PropTypes.func.isRequired,\n    acceptChallenge: PropTypes.func.isRequired,\n    makeMove: PropTypes.func.isRequired,\n  }).isRequired,\n  currentUser: PropTypes.shape({\n    accountId: PropTypes.string.isRequired,\n    balance: PropTypes.string.isRequired,\n  }),\n  nearConfig: PropTypes.shape({\n    contractName: PropTypes.string.isRequired,\n  }).isRequired,\n  wallet: PropTypes.shape({\n    requestSignIn: PropTypes.func.isRequired,\n    signOut: PropTypes.func.isRequired,\n  }).isRequired,\n};\n\nexport default App;\n","import { deepOrange } from \"@material-ui/core/colors\";\nimport { createMuiTheme } from \"@material-ui/core/styles\";\n\nconst theme = createMuiTheme({\n  palette: {\n    type: \"dark\",\n    primary: {\n      main: \"#202020\",\n    },\n    secondary: {\n      main: \"#1de9b6\",\n    },\n    error: {\n      main: deepOrange.A400,\n    },\n  },\n});\n\nexport default theme;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport getConfig from \"./config.js\";\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\nimport { ThemeProvider } from \"@material-ui/core/styles\";\nimport theme from \"./theme\";\nimport * as nearAPI from \"near-api-js\";\nimport \"react-chessground/dist/styles/chessground.css\";\n\n// Initializing contract\nasync function initContract() {\n  const nearConfig = getConfig(process.env.NODE_ENV || \"testnet\");\n\n  // Initializing connection to the NEAR TestNet\n  const near = await nearAPI.connect({\n    deps: {\n      keyStore: new nearAPI.keyStores.BrowserLocalStorageKeyStore(),\n    },\n    ...nearConfig,\n  });\n\n  // Needed to access wallet\n  const walletConnection = new nearAPI.WalletConnection(near);\n\n  // Load in account data\n  let currentUser;\n  if (walletConnection.getAccountId()) {\n    currentUser = {\n      accountId: walletConnection.getAccountId(),\n      balance: (await walletConnection.account().state()).amount,\n    };\n  }\n\n  // Initializing our contract APIs by contract name and configuration\n  const contract = await new nearAPI.Contract(\n    walletConnection.account(),\n    nearConfig.contractName,\n    {\n      // View methods are read-only – they don't modify the state, but usually return some value\n      viewMethods: [\"getBoardState\"],\n      // Change methods can modify the state, but you don't receive the returned value when called\n      changeMethods: [\"createGame\", \"acceptChallenge\", \"makeMove\"],\n      // Sender is the account ID to initialize transactions.\n      // getAccountId() will return empty string if user is still unauthorized\n      sender: walletConnection.getAccountId(),\n    }\n  );\n\n  return { contract, currentUser, nearConfig, walletConnection };\n}\n\nwindow.nearInitPromise = initContract().then(\n  ({ contract, currentUser, nearConfig, walletConnection }) => {\n    ReactDOM.render(\n      <ThemeProvider theme={theme}>\n        <CssBaseline />\n        <App\n          contract={contract}\n          currentUser={currentUser}\n          nearConfig={nearConfig}\n          wallet={walletConnection}\n        />\n      </ThemeProvider>,\n      document.getElementById(\"root\")\n    );\n  }\n);\n"],"sourceRoot":""}